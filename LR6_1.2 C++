#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define MAX_SIZE 100

// генерация случайного числа в диапазоне [min, max]
int randomInRange(int min, int max) {
    return min + rand() % (max - min + 1);
}

// вывод матрицы
void printMatrix(int matrix[MAX_SIZE][MAX_SIZE], int m, int n, const char *title) {
    printf("%s:\n", title);
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            printf("%6d ", matrix[i][j]);
        }
        printf("\n");
    }
    printf("\n");
}

// сортировка первой половины столбца по возрастанию
void sortFirstHalfColumn(int matrix[MAX_SIZE][MAX_SIZE], int m, int col) {
    int half = m / 2;
    // пузырьковая сортировка
    for (int i = 0; i < half - 1; i++) {
        for (int j = 0; j < half - i - 1; j++) {
            if (matrix[j][col] > matrix[j + 1][col]) {
                int temp = matrix[j][col];
                matrix[j][col] = matrix[j + 1][col];
                matrix[j + 1][col] = temp;
            }
        }
    }
}

// возведение в квадрат всех элементов столбца
void squareColumn(int matrix[MAX_SIZE][MAX_SIZE], int m, int col) {
    for (int i = 0; i < m; i++) {
        matrix[i][col] = matrix[i][col] * matrix[i][col];
    }
}

// замена всех элементов столбца на ноль
void zeroColumn(int matrix[MAX_SIZE][MAX_SIZE], int m, int col) {
    for (int i = 0; i < m; i++) {
        matrix[i][col] = 0;
    }
}

// подсчёт положительных и отрицательных чисел в столбце
void countPosNeg(int matrix[MAX_SIZE][MAX_SIZE], int m, int col, int *pos, int *neg) {
    *pos = 0;
    *neg = 0;
    for (int i = 0; i < m; i++) {
        if (matrix[i][col] > 0) {
            (*pos)++;
        } else if (matrix[i][col] < 0) {
            (*neg)++;
        }
    }
}

int main() {
    int matrix[MAX_SIZE][MAX_SIZE];
    int m, n;
    
    srand(time(NULL));
    
    // ввод размеров матрицы
    printf("Введите количество строк M: ");
    scanf("%d", &m);
    printf("Введите количество столбцов N: ");
    scanf("%d", &n);
    
    if (m <= 0 || m > MAX_SIZE || n <= 0 || n > MAX_SIZE) {
        printf("Ошибка: размеры должны быть от 1 до %d\n", MAX_SIZE);
        return 1;
    }
    
    // выбор способа заполнения
    int choice;
    printf("Выберите способ заполнения матрицы:\n");
    printf("1 - Случайные числа\n");
    printf("2 - Ввод вручную\n");
    printf("Ваш выбор: ");
    scanf("%d", &choice);
    
    if (choice == 2) {
        printf("Введите элементы матрицы (%d x %d):\n", m, n);
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                printf("matrix[%d][%d] = ", i, j);
                scanf("%d", &matrix[i][j]);
            }
        }
    } else {
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                matrix[i][j] = randomInRange(-100, 100);
            }
        }
    }
    
    printMatrix(matrix, m, n, "Исходная матрица");
    
    // обработка каждого столбца
    for (int j = 0; j < n; j++) {
        int pos, neg;
        countPosNeg(matrix, m, j, &pos, &neg);
        
        printf("Столбец %d: положительных = %d, отрицательных = %d -> ", j, pos, neg);
        
        if (pos > neg) {
            printf("сортировка первой половины\n");
            sortFirstHalfColumn(matrix, m, j);
        } else if (pos < neg) {
            printf("возведение в квадрат\n");
            squareColumn(matrix, m, j);
        } else {
            printf("замена на нули\n");
            zeroColumn(matrix, m, j);
        }
    }
    printf("\n");
    
    printMatrix(matrix, m, n, "Модифицированная матрица");
    
    return 0;
}
