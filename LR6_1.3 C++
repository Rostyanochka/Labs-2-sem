#include <iostream>
#include <vector>
#include <random>
#include <ctime>
#include <algorithm>

using namespace std;

const int MAX_SIZE = 100;

// минимум из трёх чисел
int min3(int a, int b, int c) {
    return min({a, b, c});
}

// вывод матрицы
void printMatrix(const vector<vector<int>>& matrix, int m, int n, const string& title) {
    cout << title << ":" << endl;
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            cout << matrix[i][j] << " ";
        }
        cout << endl;
    }
    cout << endl;
}

int main() {
    int m, n;
    
    // ввод размеров матрицы
    cout << "Введите количество строк M: ";
    cin >> m;
    cout << "Введите количество столбцов N: ";
    cin >> n;
    
    if (m <= 0 || m > MAX_SIZE || n <= 0 || n > MAX_SIZE) {
        cout << "Ошибка: размеры должны быть от 1 до " << MAX_SIZE << endl;
        return 1;
    }
    
    vector<vector<int>> matrix(m, vector<int>(n));
    vector<vector<int>> dp(m, vector<int>(n));  // dp[i][j] = размер максимальной квадратной подматрицы с правым нижним углом в (i,j)
    vector<int> countBySize(min(m, n) + 1, 0);   // количество квадратов каждого размера
    
    // выбор способа заполнения
    int choice;
    cout << "Выберите способ заполнения матрицы:" << endl;
    cout << "1 - Случайные числа (0 и 1)" << endl;
    cout << "2 - Ввод вручную" << endl;
    cout << "Ваш выбор: ";
    cin >> choice;
    
    if (choice == 2) {
        cout << "Введите элементы матрицы (только 0 и 1), " << m << " x " << n << ":" << endl;
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                cout << "matrix[" << i << "][" << j << "] = ";
                int val;
                cin >> val;
                matrix[i][j] = (val != 0 ? 1 : 0);
            }
        }
    } else {
        static mt19937 gen(time(nullptr));
        uniform_int_distribution<> dis(0, 1);
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                matrix[i][j] = dis(gen);
            }
        }
    }
    
    printMatrix(matrix, m, n, "Матрица");
    
    // динамическое программирование для подсчёта квадратных подматриц из единиц
    int totalSquares = 0;
    
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            if (matrix[i][j] == 1) {
                if (i == 0 || j == 0) {
                    dp[i][j] = 1;
                } else {
                    dp[i][j] = min3(dp[i-1][j], dp[i][j-1], dp[i-1][j-1]) + 1;
                }
                // каждая позиция с dp[i][j] = k вносит вклад в квадраты размеров 1, 2, ..., k
                for (int size = 1; size <= dp[i][j]; size++) {
                    countBySize[size]++;
                    totalSquares++;
                }
            } else {
                dp[i][j] = 0;
            }
        }
    }
    
    // вывод результатов
    cout << "=== Результаты ===" << endl;
    cout << "Общее количество квадратных подматриц из единиц: " << totalSquares << endl << endl;
    
    cout << "Распределение по размерам:" << endl;
    for (int size = 1; size < countBySize.size(); size++) {
        if (countBySize[size] > 0) {
            cout << "  Размер " << size << "×" << size << ": " << countBySize[size] << " квадрат(ов)" << endl;
        }
    }
    
    if (totalSquares == 0) {
        cout << "  Квадратных подматриц из единиц не найдено." << endl;
    }
    
    return 0;
}
